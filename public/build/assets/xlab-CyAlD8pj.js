function A(u,s,c="images[]",e,i=null,a="Glissez et déposez des images ici",r=null,p=[],h=1/0){const g=document.getElementById(u);if(!g||Dropzone.instances.some(l=>l.element===g))return;Dropzone.autoDiscover=!1,new Dropzone(`#${u}`,{url:s,paramName:c,maxFile:h,maxFilesize:2,acceptedFiles:e,dictDefaultMessage:a,dictRemoveFile:"Retirer",autoProcessQueue:!1,addRemoveLinks:!0,autoDiscover:!1,init:function(){(Array.isArray(p)?p:[p]).forEach(t=>{if(t.size<=0)return;const n={name:t.nom,size:t.size,path:t.path};this.displayExistingFile(n,t.url,null,null)}),this.on("addedfile",function(t){i&&v(this,i)}),this.on("removedfile",function(t){if(r){const n=document.getElementById(r);if(n){const f=n.value?JSON.parse(n.value):[];t.path?f.push(t.path):f.push(t.name),n.value=JSON.stringify(f)}}i&&v(this,i)})}});function v(l,t){const n=document.getElementById(t);if(!n)return;const f=new DataTransfer;l.files.forEach(S=>{S instanceof File&&f.items.add(S)}),n.files=f.files}}function V(){const u=$("#zones-container"),s=$("#zonesp-container"),c=$("#addZone"),e=$("#addZonep"),i=document.getElementById("form-pratique"),a=document.querySelectorAll(".zone-container"),r=document.querySelectorAll(".zonep-container"),p="#ececec";i.addEventListener("submit",function(o){o.preventDefault();const d=document.querySelectorAll(".zone-container");!d||d.length<=0?alert("Veillez renseigner au moins une zone"):i.checkValidity()?i.submit():alert("Le formulaire contient des erreurs. Veuillez les corriger.")}),h(c,1,u),g("pays","zone-container","localite",1),h(e,2,s),g("paysp","zonep-container","localitep",2);function h(o,d,m){o.off("click").on("click",function(){v(m,"append",d)})}$(document).on("click",".removeZone",function(o){b(o,"zone-container")}),$(document).on("click",".removeZonep",function(o){console.log("clickded"),b(o,"zonep-container")}),S(a),E(r),$(document).on("change",".localite",function(){const o=$(this).closest(".zone-container")[0];n(o)}),$(document).on("change",".localitep",function(){const o=$(this).closest(".zonep-container")[0];n(o)});function g(o,d,m,w){$(document).on("change",`.${o}`,function(){let y=$(this).val(),x=$(this).closest(`.${d}`).find(`.${m}`);v(x,"replace",w,y)})}function v(o,d="append",m,w=null){let y=document.getElementById("loader");y.style.display="block";let x=w?`/formulaire/${m}/${w}`:`/formulaire/${m}`;fetch(x).then(z=>{if(!z.ok)throw new Error("Unknown error");return z.json()}).then(z=>{if(z&&z.success){let F=$(o),D=z.html.original?z.html.original.html:z.html;d==="replace"?F.html(D):d==="append"&&F.append(D),t(F),$(".js-example-basic-single").select2()}}).catch(z=>{alert("OOps! une erreur s'est produite. Veuiller recharger la page et ressayer")}).finally(()=>{y.style.display="none"})}function l(o){let d=$(o).find("select").filter("[required]"),m=!0;return d.each(function(w){if(($(this).val()?$(this).val().trim():"")==="")return m=!1,!1}),m}function t(o){l(o)?c.prop("disabled",!1):c.prop("disabled",!0)}function n(o){if(!o)return;const d=o.querySelectorAll("select"),m=Array.from(d).every(w=>w.checkValidity());o.style.backgroundColor=m?p:""}function f(o){if(!o)return;const d=o.querySelectorAll("select"),m=[];for(let y=0;y<d.length;y+=2)m.push([d[y],d[y+1]]);const w=m.every(([y,x])=>y.value&&x.value&&y.checkValidity()&&x.checkValidity());o.style.backgroundColor=w?p:""}function S(o){o.forEach(n)}function E(o){o.forEach(f)}function b(o,d){o.preventDefault(),o.stopPropagation();const m=$(o.currentTarget).closest(`.${d}`);m.length&&m.remove()}}function _(){document.querySelectorAll('input[type="text"], textarea').forEach(u=>{u.addEventListener("blur",function(){this.value=this.value.trim()})})}class C{ajax(s,c={},e=()=>{},i=()=>{},a=()=>{}){const r={method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({})},p={...r,...c,headers:{...r.headers,...c.headers||{}}};fetch(s,p).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>{e(h)}).catch(h=>{i(h)}).finally(()=>{a()})}}function O(u,s={}){const c={inputName:"images[]",acceptedFiles:null,message:"Glissez et déposez des images ici",removedInputId:null,existingFiles:[],maxFiles:1/0,addHidden:!1,displayOnly:!1,url:"/file-upload"};Dropzone.autoDiscover=!1;const e=Object.assign({},c,s);e.maxFiles===1&&(e.inputName=e.inputName.replace(/\[\]$/,"")),document.querySelectorAll(u).forEach(a=>{if(Dropzone.instances.some(l=>l.element===a))return;e.displayOnly&&a.classList.add("dropzone-display-only");const r={url:e.url,paramName:e.inputName,acceptedFiles:e.acceptedFiles,dictDefaultMessage:e.displayOnly?"":e.message,autoProcessQueue:e.autoProcessQueue??!1,addRemoveLinks:!e.displayOnly,clickable:!e.displayOnly,autoDiscover:!1,dictRemoveFile:e.dictRemoveFile??"Retirer",...e},p=new Dropzone(a,r);if(p.on("addedfile",function(l){if(g(this),this.files.length>e.maxFiles){const t=this.files.length-2;t>=0&&this.removeFile(this.files[t])}}),p.on("removedfile",function(l){if(!l.upload){const t=document.createElement("input");t.type="hidden",t.name="removed_"+e.inputName,t.value=l.path??l.dataURL,a.appendChild(t)}g(this)}),(Array.isArray(e.existingFiles)?e.existingFiles:[e.existingFiles]).forEach(l=>{if(!l||!l.size||l.size<=0)return;const t={name:l.nom,size:l.size,path:l.path};p.files.push(t),p.displayExistingFile(t,l.url,null,null),setTimeout(()=>{a.querySelectorAll(".dz-filename").forEach(n=>{t.name||(n.style.display="none")}),a.querySelectorAll(".dz-size").forEach(n=>{t.size||(n.style.display="none")})},100)}),e.addHidden&&!e.displayOnly){const l=v(e.inputName,"file");a.appendChild(l)}function g(l){const t=l.element.querySelector('input[type="file"]');if(!t)return;const n=new DataTransfer;l.files.forEach(f=>{f instanceof File&&n.items.add(f)}),t.files=n.files}function v(l,t){const n=document.createElement("input");return n.type=t,n.name=l,n.id=l.replace(/\[\]$/,""),(e.maxFiles===1/0||e.maxFiles>1)&&(n.multiple=!0),n.style.display="none",n}})}function T(){(function(u){function s(){var i=`
    @media (max-width: 768px) {
        .d-md-block {
            position: absolute !important;
        }
        #sommaire {
            z-index: 9999 !important;
            background-color: #fff !important;
        }
        .d-none {
            display: none !important;
        }
    }
`,a=document.createElement("style");a.type="text/css",a.innerText=i,document.head.appendChild(a)}function c(){u('[data-toggle="popup"]').each(function(){const i=u(this),a=i.data("target"),r=u("#"+a);i.off("click").on("click",function(){window.innerWidth<=768?r.toggleClass("d-none"):r.toggleClass("d-md-block")})})}function e(){window.innerWidth<=768?document.body.classList.add("small-screen"):document.body.classList.remove("small-screen")}u(document).ready(function(){s(),c(),e()}),u(window).on("resize",function(){e()})})(jQuery)}function k(){$("[data-hide]").each(function(){var u=$(this).data("hide");const s=$(this);var c=u==="windows"?$(window):$(u);const e=$(this).data("if"),[i,a]=e.split(":");c.off("click").on("click",function(){const r=window.getComputedStyle(this);i&&a&&r.getPropertyValue(i)==a&&s.removeClass("d-md-block")})})}$(document).ready(function(){k()});class I{constructor(s){this.checkboxesSelector=s.checkboxesSelector,this.initialDataKey=s.initialDataKey,this.loaderSelector=s.loaderSelector,this.endpoint=s.endpoint,this.action=s.action,this.autoProcess=s.autoProcess||!1,this.loader=document.querySelector(this.loaderSelector),this.autoProcess&&this.setupAutoProcess()}getSelectedValues(s){return Array.from(document.querySelectorAll(`${s}:checked`)).map(c=>c.value)}getInitialDataValues(s){const c=document.querySelectorAll(`[data-${s}]`),e=[];return c.forEach(i=>{const a=i.getAttribute(`data-${s}`);a&&e.push(a)}),e}getUnselectedValues(){const s=this.getInitialDataValues(this.initialDataKey),c=this.getSelectedValues(this.checkboxesSelector);return s.filter(e=>!c.includes(e))}getNewValues(){const s=this.getInitialDataValues(this.initialDataKey);return this.getSelectedValues(this.checkboxesSelector).filter(e=>!s.includes(e))}showLoader(){this.loader&&(this.loader.style.display="block")}hideLoader(){this.loader&&(this.loader.style.display="none")}massActions(s={},c=null){const e=this.getUnselectedValues(),i=this.getNewValues();if(this.action&&(e.length>0||i.length>0)){this.showLoader();const a=JSON.stringify({unselected_values:e,new_values:i,action:this.action,...s});xlab.Http.ajax(this.endpoint,{body:a},r=>{console.log("from massActions",r),c&&c(r),this.hideLoader()})}else console.log("Aucune sélection ou action définie.")}setupAutoProcess(){document.querySelectorAll(this.checkboxesSelector).forEach(c=>{c.addEventListener("change",()=>this.massActions())})}serializeForm(s){const c=document.querySelector(s);if(!c)return{};const e=new FormData(c),i={};return e.forEach((a,r)=>{i[r]?i[r]=[].concat(i[r],a):i[r]=a}),i}}function q(u,s,c="images[]",e,i=null,a="Glissez et déposez des images ici",r=null,p=[],h=50){const g=document.getElementById(u);if(!g||Dropzone.instances.some(l=>l.element===g))return;Dropzone.autoDiscover=!1,new Dropzone(`#${u}`,{url:s,paramName:c,maxFile:1,maxFilesize:h,acceptedFiles:e,dictDefaultMessage:a,dictRemoveFile:"Retirer",autoProcessQueue:!1,addRemoveLinks:!0,autoDiscover:!1,init:function(){(Array.isArray(p)?p:[p]).forEach(t=>{if(t.size<=0)return;const n={name:t.video_name,size:t.size,path:t.path};this.displayExistingFile(n,t.url,null,null)}),this.on("addedfile",function(t){i&&v(this,i)}),this.on("removedfile",function(t){if(r){const n=document.getElementById(r);if(n){const f=n.value?JSON.parse(n.value):[];t.path?f.push(t.path):f.push(t.name),n.value=JSON.stringify(f)}}i&&v(this,i)})}});function v(l,t){const n=document.getElementById(t);if(!n)return;const f=new DataTransfer;l.files.forEach(S=>{S instanceof File&&f.items.add(S)}),n.files=f.files}}window.xlab=window.xlab||{};window.xlab.InitDropZone=A;window.xlab.DynamicZone=V;window.xlab.InputsTrim=_;window.xlab.Http=new C;window.xlab.InitDropZone2=O;window.xlab.InitDropZoneVideo=q;window.xlab.InitAsideToggle=T;window.xlab.InitHideOnClick=k;window.xlab.Form=I;
